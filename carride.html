<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø­Ø§ÙƒØ§Ø© ÙˆØµÙˆÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© â€” Track</title>
  <style>
    /* ØªØµÙ…ÙŠÙ… Ø¨Ø³ÙŠØ· ÙˆØ¬Ù…ÙŠÙ„ */
    :root{--bg:#0f172a;--card:#071133;--accent:#00b894}
    body{margin:0;font-family:system-ui, "Segoe UI", Roboto, Arial;color:#fff;background:linear-gradient(180deg,#071133 0%, #021029 100%);}
    .container{display:flex;flex-direction:column;height:100vh;gap:12px;padding:14px}
    header{display:flex;align-items:center;justify-content:space-between}
    h1{font-size:1.1rem;margin:0}
    .controls{display:flex;gap:10px;align-items:center}
    button{background:var(--accent);border:none;padding:10px 14px;border-radius:10px;font-weight:600;color:#022;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff}
    .card{background:rgba(255,255,255,0.03);border-radius:12px;padding:12px;display:flex;gap:12px;align-items:center}
    #map{height:70vh;border-radius:12px;border:4px solid rgba(255,255,255,0.02)}
    .info{min-width:220px}
    .timer{font-size:1.6rem;font-weight:700}
    .small{font-size:0.85rem;color:rgba(255,255,255,0.7)}
    .seat-badge{background:rgba(255,255,255,0.06);padding:6px 10px;border-radius:999px}
    footer{font-size:0.8rem;text-align:center;color:rgba(255,255,255,0.6)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Ù…Ø­Ø§ÙƒØ§Ø© ÙˆØµÙˆÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© â€” ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ø¹ Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„ÙˆØµÙˆÙ„</h1>
      <div class="controls">
        <div class="card info">
          <div class="small">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„ÙˆØµÙˆÙ„</div>
          <div id="countdown" class="timer">--:--</div>
          <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
            <div class="small">Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</div>
            <div class="seat-badge" id="seats">3 / 4</div>
          </div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button id="startBtn">Ø§Ø¨Ø¯Ø£</button>
          <button id="cancelBtn" class="ghost">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²</button>
        </div>
      </div>
    </header>

    <div id="map"></div>

  </div>

  <script>
    // Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø³Ø±ÙŠØ¹Ø©:
    // 1) Ø§Ø³ØªØ¨Ø¯Ù„ "YOUR_API_KEY_HERE" Ø¨Ù…ÙØªØ§Ø­ API Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ ØªØ§Øº Ø³ÙƒØ±Ø¨Øª Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ù„Ù.
    // 2) Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„ ÙŠØ³ØªØ®Ø¯Ù… Ù…Ø³Ø§Ø±Ù‹Ø§ Ø«Ø§Ø¨ØªÙ‹Ø§ (Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª) Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©.

    let map, marker, routePolyline, animationId;
    let route = [
      // Ù…Ø«Ø§Ù„ Ù†Ù‚Ø§Ø· ÙÙŠ Ø¹Ù…Ù‘Ø§Ù† - ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯Ù‡Ø§
      {lat:31.9550, lng:35.9457},
      {lat:31.9575, lng:35.9389},
      {lat:31.9597, lng:35.9330},
      {lat:31.9628, lng:35.9290},
      {lat:31.9655, lng:35.9250}
    ];

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ©
    const updateInterval = 80; // ms between updates
    const speedMetersPerSec = 10; // Ø³Ø±Ø¹Ø© ÙˆÙ‡Ù…ÙŠØ© (Ù…ØªØ±/Ø«)

    // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©
    let sim = {
      playing: false,
      currentIndex: 0,
      t: 0, // progress Ø¨ÙŠÙ† Ù†Ù‚Ø·ØªÙŠÙ† (0..1)
      remainingSeconds: 0
    };

    function initMap(){
      map = new google.maps.Map(document.getElementById('map'), {
        center: route[0],
        zoom: 14,
        disableDefaultUI: false,
      });

      // Ø®Ø· Ø§Ù„Ù…Ø³Ø§Ø±
      routePolyline = new google.maps.Polyline({
        path: route,
        geodesic: true,
        strokeOpacity: 0.8,
        strokeWeight: 4,
      });
      routePolyline.setMap(map);

      // Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø§Ø³ØªØ¹Ù…Ù„Ù†Ø§ Ø£ÙŠÙ‚ÙˆÙ†Ø© svg Ø¨Ø³ÙŠØ·Ø©)
      const carSvg = {
        path: 'M10 2 H 54 L 62 20 V 34 L 54 46 H 10 L 2 34 V 20 Z',
        fillColor: '#ffdd57',
        fillOpacity: 1,
        scale: 0.5,
        strokeWeight: 0.5,
        anchor: new google.maps.Point(32, 24),
      };

      marker = new google.maps.Marker({
        position: route[0],
        map,
        title: 'Ù…Ø±ÙƒØ¨ØªÙƒ',
        optimized: false,
        icon: carSvg
      });

      // Ù„ÙŠØ¸Ù‡Ø± Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙƒØ§Ù…Ù„Ø©
      const bounds = new google.maps.LatLngBounds();
      route.forEach(p => bounds.extend(p));
      map.fitBounds(bounds);

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø²Ø±Ø§Ø±
      document.getElementById('startBtn').addEventListener('click', startSimulation);
      document.getElementById('cancelBtn').addEventListener('click', cancelSimulation);
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø¨ÙŠÙ† Ù†Ù‚Ø·ØªÙŠÙ† (Ù…ØªØ±) - Haversine
    function haversineDistance(a, b){
      const R = 6371000; // earth radius meters
      const toRad = d => d * Math.PI / 180;
      const dLat = toRad(b.lat - a.lat);
      const dLon = toRad(b.lng - a.lng);
      const lat1 = toRad(a.lat);
      const lat2 = toRad(b.lat);
      const sinDLat = Math.sin(dLat/2);
      const sinDLon = Math.sin(dLon/2);
      const AA = sinDLat*sinDLat + Math.cos(lat1)*Math.cos(lat2)*sinDLon*sinDLon;
      const C = 2*Math.atan2(Math.sqrt(AA), Math.sqrt(1-AA));
      return R * C;
    }

    // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø¨Ø´ÙƒÙ„ Ù…ØªØ­Ø±Ùƒ
    function stepSimulation(){
      if(!sim.playing) return;

      // Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      const A = route[sim.currentIndex];
      const B = route[Math.min(sim.currentIndex+1, route.length-1)];
      const dist = haversineDistance(A,B);

      // Ø­Ø³Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆÙˆÙ‚Øª Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù†Ø­Ø¯Ù‘Ø« Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… t
      const dt = (updateInterval/1000) * speedMetersPerSec; // meters moved this step
      const progressDelta = dist > 0 ? dt / dist : 1;
      sim.t += progressDelta;

      if(sim.t >= 1){
        // Ø°Ù‡Ø¨Øª Ù„Ù„Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
        sim.currentIndex = Math.min(sim.currentIndex+1, route.length-1);
        sim.t = 0;
      }

      // Ù†Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶ Ø§Ù„Ø®Ø·ÙŠ Ø§Ù„Ø¨Ø³ÙŠØ·
      const curLat = A.lat + (B.lat - A.lat) * sim.t;
      const curLng = A.lng + (B.lng - A.lng) * sim.t;
      const curPos = {lat: curLat, lng: curLng};
      marker.setPosition(curPos);

      // Ø¹Ù…Ù„ Ø¯ÙˆØ±Ø§Ù† Ø¨Ø³ÙŠØ· Ù„Ù„Ø±Ù…Ø² (Ù„ÙŠØ³ Ø¯Ù‚ÙŠÙ‚ Ø¬ØºØ±Ø§ÙÙŠÙ‹Ø§ Ù„ÙƒÙ† ÙŠØ¹Ø·ÙŠ Ø¥Ø­Ø³Ø§Ø³ Ø¨Ø§Ù„Ø­Ø±ÙƒØ©)
      // Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø§ØªØ¬Ø§Ù‡ Ù…Ù† A Ø¥Ù„Ù‰ B
      const angle = Math.atan2(B.lng - A.lng, B.lat - A.lat) * (180/Math.PI);
      marker.setIcon(Object.assign({}, marker.getIcon(), {rotation: angle}));

      // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§ Ù†Ø­Ùˆ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
      map.panTo(curPos);

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
      // Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ù†Ù‚Ø§Øµ Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø±Ù‘Øª 1000ms
      const now = Date.now();

      // Ù†Ø³ØªØ®Ø¯Ù… setTimeout Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† requestAnimationFrame Ù„ØªØ¨Ø³ÙŠØ· Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
      animationId = setTimeout(stepSimulation, updateInterval);
    }

    function startSimulation(){
      if(sim.playing) return;
      // Ù†Ø­Ø¯Ø¯ ÙˆÙ‚Øª ÙˆØµÙˆÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† 1 Ùˆ 7 Ø¯Ù‚Ø§Ø¦Ù‚
      const minutes = Math.floor(Math.random()*7) + 1;
      sim.remainingSeconds = minutes * 60;
      updateCountdownDisplay();

      // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø³Ø§Ø±
      sim.playing = true;
      sim.currentIndex = 0;
      sim.t = 0;
      marker.setPosition(route[0]);

      // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø¹Ø¯Ø§Ø¯
      countdownTick();

      // Ø¨Ø¯Ø¡ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
      stepSimulation();

      document.getElementById('startBtn').disabled = true;
    }

    function cancelSimulation(){
      if(!sim.playing) return;
      sim.playing = false;
      clearTimeout(animationId);
      // Ø¥ÙŠÙ‚Ø§Ù Ø¹Ø¯Ø§Ø¯
      sim.remainingSeconds = 0;
      updateCountdownDisplay();
      document.getElementById('startBtn').disabled = false;
      alert('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² â€” Ø³ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ù…Ø®Ø§Ù„ÙØ© Ø­Ø³Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… (Ù…Ø«Ø§Ù„).');
    }

    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯
    function updateCountdownDisplay(){
      const el = document.getElementById('countdown');
      if(sim.remainingSeconds <= 0){
        el.textContent = '--:--';
      } else {
        const mm = Math.floor(sim.remainingSeconds/60).toString().padStart(2,'0');
        const ss = (sim.remainingSeconds%60).toString().padStart(2,'0');
        el.textContent = mm + ':' + ss;
      }
    }

    // ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© Ù†Ù‚Ù„Ù„ Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ Ø§Ù„Ø³Ø§Ø®Ù†Ø©
    let countdownInterval = null;
    function countdownTick(){
      if(countdownInterval) clearInterval(countdownInterval);
      countdownInterval = setInterval(()=>{
        if(!sim.playing){ clearInterval(countdownInterval); return; }
        sim.remainingSeconds = Math.max(0, sim.remainingSeconds - 1);
        updateCountdownDisplay();
        if(sim.remainingSeconds === 0){
          // ÙˆØµÙ„Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©!
          sim.playing = false;
          clearTimeout(animationId);
          clearInterval(countdownInterval);
          document.getElementById('startBtn').disabled = false;
          alert('ÙˆØµÙ„Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ğŸŸ¢');
        }
      }, 1000);
    }

    // ØªØ­Ù…ÙŠÙ„ Ø®Ø±Ø§Ø¦Ø· Google â€” ØªØ°ÙƒÙ‘Ø± Ø§Ø³ØªØ¨Ø¯Ø§Ù„ KEY
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOVYRIgupAurZup5y1PRh8Ismb1A3lLao&libraries=places&callback=initMap"></script>
</body>
</html>
